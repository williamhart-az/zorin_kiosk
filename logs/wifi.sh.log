2025-05-20 17:06:23 - Starting wifi.sh script. Path: /home/alocalbox/zorin_kiosk/features/wifi.sh, Current directory: /home/alocalbox/zorin_kiosk
2025-05-20 17:06:23 - Error handling enabled with 'set -e'
2025-05-20 17:06:23 - Checking if script is running as root
2025-05-20 17:06:23 - Script is running as root, continuing
2025-05-20 17:06:23 - Checking for environment file
2025-05-20 17:06:23 - ENV_FILE not defined, using default: features/../.env
2025-05-20 17:06:23 - Checking if environment file exists at: features/../.env
2025-05-20 17:06:23 - Sourcing environment file: features/../.env
2025-05-20 17:06:23 - Environment file sourced successfully. WIFI_SSID=LAT-Staff
2025-05-20 17:06:23 - Feature: Restricting network settings access
2025-05-20 17:06:23 - Checking if dconf is installed
2025-05-20 17:06:23 - dconf is available.
2025-05-20 17:06:23 - Creating dconf profile directory /etc/dconf/profile/...
2025-05-20 17:06:23 - Writing user profile configuration to /etc/dconf/profile/user...
2025-05-20 17:06:23 - Creating dconf database directory /etc/dconf/db/local.d/...
2025-05-20 17:06:23 - Creating network settings restrictions file /etc/dconf/db/local.d/00-network...
2025-05-20 17:06:23 - Network settings restrictions file created.
2025-05-20 17:06:23 - Creating dconf locks directory /etc/dconf/db/local.d/locks/...
2025-05-20 17:06:23 - Creating network settings locks file /etc/dconf/db/local.d/locks/network...
2025-05-20 17:06:23 - Network settings locks file created.
2025-05-20 17:06:23 - Updating dconf database...
2025-05-20 17:06:23 - Network settings restrictions applied successfully.
2025-05-20 17:06:23 - Feature: WiFi Configuration
2025-05-20 17:06:23 - Checking WiFi configuration settings...
2025-05-20 17:06:23 - Ensuring required WiFi packages are installed
2025-05-20 17:06:23 - Installing missing packages: iw net-tools
2025-05-20 17:06:27 - Package installation attempt completed.
2025-05-20 17:06:27 - Checking if WiFi credentials are provided in environment file (WIFI_SSID and WIFI_PASSWORD)...
2025-05-20 17:06:27 - WiFi credentials found. SSID: LAT-Staff
2025-05-20 17:06:27 - Creating/ensuring persistent WiFi connection file for 'LAT-Staff'...
2025-05-20 17:06:27 - Creating persistent WiFi connection for SSID: LAT-Staff
2025-05-20 17:06:27 - Detecting security type for SSID: LAT-Staff
2025-05-20 17:06:27 - Rescanning for WiFi networks to detect security for LAT-Staff...
2025-05-20 17:06:29 - Detected security string for 'LAT-Staff': WPA2
2025-05-20 17:06:29 - Interpreted security type as WPA2 for 'LAT-Staff'.
2025-05-20 17:06:29 - Using detected security type: WPA2 for SSID: LAT-Staff
2025-05-20 17:06:29 - Ensuring NetworkManager system connections directory exists: /etc/NetworkManager/system-connections/
2025-05-20 17:06:29 - Generated UUID for persistent connection 'LAT-Staff': 8da8f12d-3979-4097-ab1a-c4b783895556
2025-05-20 17:06:29 - Using WiFi interface: wlo1 for persistent connection 'LAT-Staff'.
2025-05-20 17:06:29 - Creating connection file at /etc/NetworkManager/system-connections/LAT-Staff.nmconnection for persistent connection 'LAT-Staff'.
2025-05-20 17:06:29 - Applying security settings for type: WPA2 to /etc/NetworkManager/system-connections/LAT-Staff.nmconnection
2025-05-20 17:06:29 - Applied WPA/WPA2 PSK security settings for 'LAT-Staff'.
2025-05-20 17:06:29 - Setting permissions for connection file /etc/NetworkManager/system-connections/LAT-Staff.nmconnection to 600...
2025-05-20 17:06:29 - Reloading NetworkManager connections (nmcli connection reload)...
2025-05-20 17:06:29 - Persistent WiFi connection file for 'LAT-Staff' created at /etc/NetworkManager/system-connections/LAT-Staff.nmconnection.
2025-05-20 17:06:29 - Calling main WiFi configuration function for 'LAT-Staff'...
2025-05-20 17:06:29 - Configuring WiFi connection for SSID: LAT-Staff
2025-05-20 17:06:29 - Checking if NetworkManager (nmcli) is installed
2025-05-20 17:06:29 - NetworkManager (nmcli) found, proceeding with configuration.
2025-05-20 17:06:29 - Getting WiFi interface name...
2025-05-20 17:06:29 - Found WiFi interface: wlo1
2025-05-20 17:06:29 - Ensuring WiFi is enabled via nmcli radio wifi on...
2025-05-20 17:06:29 - Scanning for WiFi networks (nmcli device wifi rescan)...
2025-05-20 17:06:31 - Checking if connection 'LAT-Staff' already exists...
2025-05-20 17:06:31 - WiFi connection for 'LAT-Staff' already exists, deleting it first...
2025-05-20 17:06:31 - Existing connection 'LAT-Staff' deleted.
2025-05-20 17:06:31 - Creating new WiFi connection for 'LAT-Staff' using nmconnection file...
2025-05-20 17:06:31 - Generated UUID for connection: a71d17d8-5dde-48cd-80db-f9bf31a0a7e7
2025-05-20 17:06:31 - Creating connection file at /etc/NetworkManager/system-connections/LAT-Staff.nmconnection
2025-05-20 17:06:31 - Setting permissions for connection file /etc/NetworkManager/system-connections/LAT-Staff.nmconnection to 600...
2025-05-20 17:06:31 - Reloading NetworkManager connections (nmcli connection reload)...
2025-05-20 17:06:31 - Activating the WiFi connection 'LAT-Staff' (nmcli connection up)...
2025-05-20 17:06:34 - Successfully activated connection 'LAT-Staff' using 'nmcli connection up'.
2025-05-20 17:06:34 - Verifying connection status for 'LAT-Staff'...
2025-05-20 17:06:34 - WiFi connection 'LAT-Staff' successfully activated.
2025-05-20 17:06:34 - Setting connection 'LAT-Staff' to autoconnect yes...
2025-05-20 17:06:34 - Making connection 'LAT-Staff' available to all users (permissions='')...
2025-05-20 17:06:34 - WiFi configuration for 'LAT-Staff' completed.
2025-05-20 17:06:34 - WiFi configuration function completed with status: 0 for 'LAT-Staff'.
2025-05-20 17:06:34 - Verifying WiFi connection for 'LAT-Staff' after configuration attempt...
2025-05-20 17:06:34 - Verifying WiFi connection to SSID: LAT-Staff
2025-05-20 17:06:37 - Connection to 'LAT-Staff' is active.
2025-05-20 17:06:37 - Testing internet connectivity by pinging 8.8.8.8...
2025-05-20 17:06:37 - Internet connectivity verified for 'LAT-Staff'.
2025-05-20 17:06:37 - WiFi connection to 'LAT-Staff' successfully verified.
2025-05-20 17:06:37 - WiFi setup script (wifi.sh) completed.
