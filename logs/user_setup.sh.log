2025-05-20 17:06:21 - Starting user_setup.sh script. Path: /home/alocalbox/zorin_kiosk/features/user_setup.sh, Current directory: /home/alocalbox/zorin_kiosk
2025-05-20 17:06:21 - Error handling enabled with 'set -e'
2025-05-20 17:06:21 - Checking if script is running as root
2025-05-20 17:06:21 - Script is running as root, continuing
2025-05-20 17:06:21 - Checking for environment file
2025-05-20 17:06:21 - ENV_FILE not defined, using default: features/../.env
2025-05-20 17:06:21 - Checking if environment file exists at: features/../.env
2025-05-20 17:06:21 - Sourcing environment file: features/../.env
2025-05-20 17:06:21 - Environment file sourced successfully
2025-05-20 17:06:21 - KIOSK_USERNAME=kiosk
2025-05-20 17:06:21 - KIOSK_FULLNAME=Kiosk User
2025-05-20 17:06:21 - OPT_KIOSK_DIR=/opt/kiosk
2025-05-20 17:06:21 - TEMPLATE_DIR=/opt/kiosk/templates
2025-05-20 17:06:21 - WALLPAPER_ADMIN_PATH=/home/alocalbox/Desktop-3840x2160.jpg
2025-05-20 17:06:21 - WALLPAPER_SYSTEM_PATH=/usr/share/backgrounds/Desktop-3840x2160.jpg
2025-05-20 17:06:21 - Feature #1: Creating kiosk user
2025-05-20 17:06:21 - Checking if user kiosk already exists
2025-05-20 17:06:21 - User kiosk does not exist, creating now
2025-05-20 17:06:22 - Setting password for kiosk
2025-05-20 17:06:22 - Adding kiosk to necessary groups
2025-05-20 17:06:22 - User kiosk created and configured successfully
2025-05-20 17:06:22 - Feature #2: Creating kiosk directories
2025-05-20 17:06:22 - Creating main kiosk directory at /opt/kiosk
2025-05-20 17:06:22 - Creating template directory at /opt/kiosk/templates
2025-05-20 17:06:22 - Creating Desktop template directory
2025-05-20 17:06:22 - Creating Documents template directory
2025-05-20 17:06:22 - Creating autostart template directory
2025-05-20 17:06:22 - Creating applications template directory
2025-05-20 17:06:22 - Setting permissions on /opt/kiosk
2025-05-20 17:06:22 - All kiosk directories created successfully
2025-05-20 17:06:22 - Feature #8: Creating kiosk initialization script
2025-05-20 17:06:22 - Initialization script will be created at: /opt/kiosk/init_kiosk.sh
2025-05-20 17:06:22 - Writing initialization script content to /opt/kiosk/init_kiosk.sh
2025-05-20 17:06:22 - Made initialization script executable
2025-05-20 17:06:22 - Kiosk initialization script created successfully
2025-05-20 17:06:22 - Feature #9: Setting up wallpaper
2025-05-20 17:06:22 - Checking for wallpaper at /home/alocalbox/Desktop-3840x2160.jpg
2025-05-20 17:06:22 - Warning: Wallpaper file not found at /home/alocalbox/Desktop-3840x2160.jpg. Continuing without wallpaper.
2025-05-20 17:06:22 - Feature #10: Setting up autostart entries
2025-05-20 17:06:22 - Creating autostart directory at /opt/kiosk/templates/.config/autostart
2025-05-20 17:06:22 - Screen blanking prevention script /opt/kiosk/disable_screensaver.sh already exists, skipping creation
2025-05-20 17:06:22 - Creating kiosk initialization autostart entry
2025-05-20 17:06:22 - Kiosk initialization autostart entry created
2025-05-20 17:06:22 - Creating screen blanking prevention autostart entry
2025-05-20 17:06:22 - Screen blanking prevention autostart entry created
2025-05-20 17:06:22 - Creating wallpaper setting autostart entry
2025-05-20 17:06:22 - Wallpaper setting autostart entry created
2025-05-20 17:06:22 - All autostart entries created successfully
2025-05-20 17:06:22 - Feature #11: Configuring auto-login for the Kiosk user
2025-05-20 17:06:22 - Creating autologin group if it doesn't exist
2025-05-20 17:06:22 - Adding kiosk to autologin group
2025-05-20 17:06:22 - Detecting display manager
2025-05-20 17:06:22 - Detected display manager service: /usr/lib/systemd/system/gdm.service
2025-05-20 17:06:22 - Checking which display manager is running
2025-05-20 17:06:22 - Found running display manager: gdm
2025-05-20 17:06:22 - Checking for LightDM
2025-05-20 17:06:22 - LightDM not detected
2025-05-20 17:06:22 - Checking for GDM
2025-05-20 17:06:22 - GDM detected, configuring for autologin
2025-05-20 17:06:22 - Creating /etc/gdm3 directory if it doesn't exist
2025-05-20 17:06:22 - Existing GDM configuration found at /etc/gdm3/custom.conf, backing up to /etc/gdm3/custom.conf.bak
2025-05-20 17:06:22 - Updating GDM configuration in /etc/gdm3/custom.conf
2025-05-20 17:06:22 - [daemon] section found, updating settings
2025-05-20 17:06:22 - GDM configuration updated
2025-05-20 17:06:22 - GDM autologin configuration completed
2025-05-20 17:06:22 - Ensuring GDM service is enabled
2025-05-20 17:06:22 - Checking for SDDM
2025-05-20 17:06:22 - SDDM not detected
2025-05-20 17:06:22 - Checking for Zorin OS 17 specific configuration
2025-05-20 17:06:22 - Detected Zorin OS version: 17
2025-05-20 17:06:22 - Applying Zorin OS 17 specific configuration
2025-05-20 17:06:22 - Using dconf to set auto-login for Zorin OS 17 for user kiosk
2025-05-20 17:06:22 - Running dconf script /tmp/dconf_autologin_kiosk.sh as kiosk
2025-05-20 17:06:22 - Dconf script execution attempted. Log at /var/log/kiosk/dconf_autologin_script.log
2025-05-20 17:06:22 - Feature #12: Configuring AccountsService for autologin
2025-05-20 17:06:22 - Creating AccountsService users directory /var/lib/AccountsService/users
2025-05-20 17:06:22 - Found Zorin session for AccountsService: zorin from /usr/share/xsessions/zorin.desktop
2025-05-20 17:06:22 - Creating AccountsService configuration for kiosk with session zorin at /var/lib/AccountsService/users/kiosk
2025-05-20 17:06:22 - Using loginctl to enable linger for kiosk
2025-05-20 17:06:22 - Creating systemd auto-login override for tty1 at /etc/systemd/system/getty@tty1.service.d/override.conf
2025-05-20 17:06:22 - Reloading systemd daemon after creating getty override
2025-05-20 17:06:23 - Systemd auto-login override for tty1 created
2025-05-20 17:06:23 - Attempting to set GSettings for auto-login (as root)
2025-05-20 17:06:23 - Running GSettings root script /tmp/gsettings_autologin_root.sh
2025-05-20 17:06:23 - GSettings root script execution attempted. Log at /var/log/kiosk/gsettings_autologin_root_script.log
2025-05-20 17:06:23 - Creating systemd user service for auto-login persistence at /home/kiosk/.config/systemd/user/kiosk-autologin.service
2025-05-20 17:06:23 - Setting ownership for /home/kiosk/.config to kiosk:kiosk
2025-05-20 17:06:23 - Enabling kiosk-autologin.service for user kiosk
2025-05-20 17:06:23 - AccountsService and related auto-login configurations completed.
2025-05-20 17:06:23 - Creating auto-login verification script at /usr/local/sbin/verify-autologin.sh
2025-05-20 17:06:23 - Made verify-autologin.sh executable
2025-05-20 17:06:23 - Creating systemd service for auto-login verification at /etc/systemd/system/verify-autologin.service
2025-05-20 17:06:23 - verify-autologin.service definition created.
2025-05-20 17:06:23 - Enabling verify-autologin.service
2025-05-20 17:06:23 - verify-autologin.service enabled.
2025-05-20 17:06:23 - User setup script completed successfully
